# @6d-ui/ajax
For Ajax calls.

Built Using :

[Axios](https://github.com/axios/axios)

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Installation](#installation)
- [Usage](#usage)
  - [AjaxUtil](#ajaxutil)
    - [Properties](#properties)
      - [responseCode](#responsecode)
      - [messages](#messages)
      - [setNotification](#setnotification)
        - [Arguments](#arguments)
      - [logout](#logout)
  - [ajax](#ajax)
    - [properties](#properties)
      - [url](#url)
      - [request](#request)
      - [makeCallBack](#makecallback)
      - [callback](#callback)
        - [Arguments](#arguments-1)
      - [loadingFunction](#loadingfunction)
      - [options](#options)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Installation
```
$ git clone http://10.0.0.15/6d-UI/ajax.git
$ cd [your project dir]
$ npm link [path of ajax]
```
## Usage
```js
import { ajax, AjaxUtil } from '@6d-ui/ajax';
setNotification (obj) {
	//Call this function to show response message
}
logout () {
	//Call this if response code is responseCode.unAuth or 401
}
loadingFunction (obj) {
	//For adding Loading screen
}
callback (response, hasError) {
	//API response
}
const ajaxUtil = new AjaxUtil({
  'responseCode' : {
    'success' : 200,
    'unAuth' : 401,
    'resultSuccess' : '0'
  },
  'messages' : {
  	'resultParam' : 'responseMsg',
    'success' : "Success Message",
    'failure' : "Failure Message"
  },
  'setNotification' : this.setNotification,
  'logout' : this.logout
});

ajax (url, request, ajaxUtil.makeCallBack, callback, loadingFunction, options);
```
### AjaxUtil
```js
const ajaxUtil = new AjaxUtil({
  'responseCode' : {
    'success' : 200,
    'unAuth' : 401,
    'resultParam' : 'resultCode',
    'resultSuccess' : '0'
  },
  'messages' : {
  	'resultParam' : 'responseMsg',
    'success' : "Success Message",
    'failure' : "Failure Message"
  },
  'setNotification' : this.setNotification,
  'logout' : this.logout
});
```
#### Properties
##### responseCode
| Property  | Type  | Default Value | Description|
| :----- |:-----| :-------|:-------------|
| success | `Integer` | `200` | http Success status code |
| unAuth | `Integer` | `401` | http Unauthorized status code |
| resultParam | `String` | `resultCode` | API Status code param name in the response |
| resultSuccess | `String` | `0` | API Status code for Success |
##### messages
| Property  | Type  | Default Value | Description|
| :----- |:-----| :-------|:-------------|
| resultParam | `String` | `responseMsg` | API response message param name in the response |
| success | `String` | `Success` | Generic Success message, valid only if resultParam for API response message is undefined |
| failure | `String` | `Please try again later` | Generic Error message, valid only if resultParam for API response message is undefined |
##### setNotification
A function called from `makeCallBack` function for showing response message.
###### Arguments
```json
{"message" : 'Error', "hasError" : true, "timestamp" : 1520839643565}
```
| Property  | Type  | Default Value | Description|
| :----- |:-----| :-------|:-------------|
| message | `String` | `Generic Error/ Success` Message |  |
| hasError | `boolean` | `true` |  |
| timestamp | `Integer` | `Current Time` | Current time stamp |
##### logout
This function is called if http status code is `Unauthorized`
### ajax
```js
ajax (url, request, ajaxUtil.makeCallBack, callback, loadingFunction, options);
```
#### properties
##### url
API URL
##### request
Request `json`
##### makeCallBack
`makeCallBack` Function from `AjaxUtil`
##### callback
API response is received here.
###### Arguments
if `makeCallBack` is defined
```js
callback (response, hasError)
```
| Property  | Type  | Description|
| :----- |:-----| :-------|
| response | `json` | API response |
| hasError | `boolean` | Response status |
***hasError*** Calculation:
- `responseCode.success` `!=` `http status code` then `hasError` = `true`
- `responseCode.resultParam` is present and is `!=` `responseCode.resultSuccess` then `hasError` = `true`

if `makeCallBack` is not defined
```js
callback (response)
```
##### loadingFunction
For adding Loading screen. At the starting of API call
```js
loadingFunction({isLoading : true, firstLoad : options.firstLoad});
//firstLoad : passed as Option
```
End of API call
```js
loadingFunction({isLoading : false, firstLoad : options.firstLoad});
//firstLoad : passed as Option
```
##### options
| Property  | Type  | Default Value | Description|
| :----- |:-----| :-------|:-------------|
| method | `String` | `POST` | API Call method `GET`/`POST` |
| isShowGenericMessage | `boolean` | `true` | If show the message `messages.success` / `messages.failure`, if `messages.resultParam` field is not present |
| isShowSuccess | `boolean` | `true` | Is show Success message, if `false` `setNotification` call is skipped in `success` cases |
| isShowFailure | `boolean` | `true` | Is show Failure message, if `false` `setNotification` call is skipped in `failure` cases |
| isProceedOnError | `boolean` | `true` | If `false` `callback` call is skipped in `failure` cases |
| isGetFile | `boolean` | `false` | Is get file request |
| authKey | `String` | `Current Time` | Basic Authorization header key, It will be passed in the header |
| firstLoad | `boolean` | `false` | Second Argument of `loadingFunction` |
